import type { User } from '@/stores/authStore'

type MarketCategory = 'perps' | 'predictions'

interface CategoryPnLData {
  unrealizedPnL: number
  positionCount: number
  totalValue?: number
  categorySpecific?: {
    openInterest?: number
    totalShares?: number
    totalInvested?: number
  }
}

interface CategoryPnLShareCardProps {
  category: MarketCategory
  data: CategoryPnLData
  user: User
  className?: string
}

const formatter = new Intl.NumberFormat('en-US', {
  style: 'currency',
  currency: 'USD',
  maximumFractionDigits: 2,
})

function formatCurrency(value: number) {
  return formatter.format(Number.isFinite(value) ? value : 0)
}

const categoryConfig = {
  perps: {
    title: 'Perpetual Futures',
    emoji: 'ðŸ“ˆ',
    gradient: 'radial-gradient(circle at top left, rgba(16, 185, 129, 0.85), rgba(10, 10, 30, 0.95)), linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(0, 102, 255, 0.35))',
  },
  predictions: {
    title: 'Prediction Markets',
    emoji: 'ðŸ”®',
    gradient: 'radial-gradient(circle at top left, rgba(168, 85, 247, 0.85), rgba(10, 10, 30, 0.95)), linear-gradient(135deg, rgba(168, 85, 247, 0.3), rgba(0, 102, 255, 0.35))',
  },
  pools: {
    title: 'Trading Pools',
    emoji: 'ðŸ’°',
    gradient: 'radial-gradient(circle at top left, rgba(249, 115, 22, 0.85), rgba(10, 10, 30, 0.95)), linear-gradient(135deg, rgba(249, 115, 22, 0.3), rgba(0, 102, 255, 0.35))',
  },
}

export function CategoryPnLShareCard({ category, data, user, className }: CategoryPnLShareCardProps) {
  const config = categoryConfig[category]
  const displayName = user.displayName || 'Babylon Trader'
  const handle =
    user.username || user.farcasterUsername || user.twitterUsername || user.walletAddress || 'anon'

  return (
    <div
      className={className}
      style={{
        width: 1200,
        height: 630,
        borderRadius: 32,
        background: config.gradient,
        color: '#F8FAFC',
        padding: '48px 64px',
        display: 'flex',
        flexDirection: 'column',
        justifyContent: 'space-between',
        fontFamily: 'Inter, sans-serif',
        position: 'relative',
        overflow: 'hidden',
      }}
    >
      <div
        style={{
          position: 'absolute',
          top: '-15%',
          right: '-10%',
          width: '480px',
          height: '480px',
          borderRadius: '50%',
          background: 'radial-gradient(circle, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0) 70%)',
        }}
      />

      <header style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', zIndex: 1 }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>
          <div
            style={{
              width: 64,
              height: 64,
              borderRadius: '50%',
              overflow: 'hidden',
              border: '3px solid rgba(255,255,255,0.25)',
              position: 'relative',
            }}
          >
            {user.profileImageUrl ? (
              <img
                src={user.profileImageUrl}
                alt={displayName}
                style={{
                  width: '100%',
                  height: '100%',
                  objectFit: 'cover',
                }}
              />
            ) : (
              <div
                style={{
                  width: '100%',
                  height: '100%',
                  background: 'linear-gradient(135deg, #0F1729, #172554)',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  fontSize: 24,
                  fontWeight: 700,
                }}
              >
                {displayName.slice(0, 1).toUpperCase()}
              </div>
            )}
          </div>
          <div>
            <p
              style={{
                fontSize: 22,
                fontWeight: 600,
                letterSpacing: '0.02em',
              }}
            >
              {displayName}
            </p>
            <p
              style={{
                fontSize: 18,
                color: 'rgba(226, 232, 255, 0.7)',
                marginTop: 2,
              }}
            >
              @{handle}
            </p>
          </div>
        </div>

        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
          <svg
            width="180"
            height="42"
            viewBox="0 0 2578 610"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle cx="327" cy="306" r="226" fill="rgba(255,255,255,0.15)"/>
            <path d="M195.856 521.991C143.813 492.214 105.51 450.989 85.2624 394.551C81.7814 384.848 78.2199 381.194 67.2479 379.908C42.2936 376.985 23.7953 362.404 12.5111 339.927C-5.49172 304.067 -4.67259 268.852 18.9285 235.552C29.6249 220.46 44.4759 210.593 62.8058 207.128C69.6663 205.831 73.2934 202.732 76.0755 196.436C93.2212 157.634 118.777 125.104 151.575 98.381C181.171 74.2683 214.975 58.349 251.886 48.9084C253.253 48.5588 256.658 47.7802 258.049 47.4999C268.255 45.4444 274.866 43.9212 281.201 33.011C292.954 12.7711 311.199 -0.0206842 335.972 2.51077e-05C356.031 0.0167943 366.85 17.3623 358.581 35.7055C357.617 37.8438 356.07 39.7834 356.295 43.176C362.858 44.8043 369.647 46.5946 376.485 48.168C427.965 60.0126 472.317 84.525 508.475 123.174C528.324 144.391 543.582 168.756 554.858 195.534C557.038 200.71 559.817 203.791 565.719 205.226C596.286 212.66 613.383 233.672 620.4 263.098C628.638 297.647 621.324 329.26 598.431 356.575C587.247 369.919 572.422 377.924 555.081 380.693C551.974 381.189 549.98 381.698 549.148 385.367C541.108 420.834 521.743 450.043 496.996 475.688C465.154 508.686 427.063 531.719 382.607 544.051C337.717 556.504 292.884 556.221 248.131 544.075C229.964 539.145 212.727 531.57 195.856 521.991ZM385.623 153.737C365.592 157.758 348.796 167.679 334.851 182.346C329.882 187.571 326.23 187.352 321.203 182.488C312.298 173.871 302.763 165.766 291.233 160.897C254.377 145.333 218.457 147.342 184.011 168.027C140.65 194.067 126.29 239.174 133.157 284.709C136.707 308.248 149.087 327.862 165.274 344.867C171.092 350.977 171.925 355.784 168.137 363.593C157.106 386.334 157.884 409.312 168.914 432.199C184.627 464.805 211.559 484.755 243.836 497.97C280.712 513.068 319.358 515.817 358.773 511.586C399.006 507.266 434.685 493.617 463.79 464.353C491.704 436.287 500.937 403.628 489.249 365.84C486.403 356.638 487.494 350.55 493.98 343.557C519.238 316.322 526.277 282.927 522.133 247.411C518.545 216.664 503.432 191.854 477.938 173.022C450.185 152.521 419.874 147.415 385.623 153.737Z" fill="white"/>
            <path d="M308.975 425.683C342.833 432.304 374.306 428.023 403.567 410.307C406.616 408.462 409.484 406.27 412.662 404.695C418.374 401.864 423.333 403.517 427.29 408.198C431.138 412.751 430.393 417.421 426.995 421.868C419.2 432.066 405.911 439.303 396.781 442.555C351.072 458.837 306.078 458.34 262.431 435.193C256.29 431.936 250.802 427.789 245.974 422.801C240.539 417.185 239.706 411.224 243.526 406.185C247.737 400.629 254.281 399.54 261.33 404.417C273.552 412.874 286.32 419.996 300.762 423.83C303.279 424.498 305.832 425.032 308.975 425.683Z" fill="white"/>
            <ellipse cx="258.764" cy="258.222" rx="30.0011" ry="30.7154" fill="white"/>
            <ellipse cx="430.198" cy="258.222" rx="30.0011" ry="30.7154" fill="white"/>
            <circle cx="370.196" cy="357.511" r="14.2862" fill="white"/>
            <circle cx="313.051" cy="357.511" r="14.2862" fill="white"/>
            <path d="M884.316 213.683C912.326 213.683 937.976 226.115 961.266 250.978C984.87 275.841 996.672 304.796 996.672 337.842C996.672 370.573 985.027 399.37 961.738 424.233C938.448 448.782 913.428 461.056 886.676 461.056C859.925 461.056 840.884 453.502 829.554 438.396C827.036 453.817 813.503 461.528 788.955 461.528C769.127 461.528 757.01 457.279 752.604 448.782C750.401 444.061 748.985 439.969 748.355 436.507C748.041 432.731 747.883 427.223 747.883 419.984V138.15C747.883 130.911 748.041 125.561 748.355 122.099C748.985 118.322 750.401 114.231 752.604 109.825C757.01 101.327 769.285 97.0782 789.427 97.0782C809.254 97.0782 821.214 101.327 825.305 109.825C827.823 114.545 829.239 118.794 829.554 122.571C830.184 126.033 830.498 131.383 830.498 138.622V236.815C843.087 221.394 861.026 213.683 884.316 213.683ZM842.773 366.167C850.641 374.664 860.397 378.913 872.042 378.913C883.687 378.913 893.6 374.664 901.783 366.167C909.966 357.669 914.057 348.227 914.057 337.842C914.057 327.456 910.281 318.014 902.727 309.517C895.174 300.704 885.103 296.298 872.514 296.298C859.925 296.298 849.854 300.704 842.3 309.517C835.062 318.329 831.442 327.928 831.442 338.314C831.442 348.385 835.219 357.669 842.773 366.167ZM1188.71 239.648C1190.6 222.023 1203.03 213.211 1226.01 213.211C1238.28 213.211 1247.41 214.155 1253.39 216.044C1259.37 217.932 1263.46 221.237 1265.66 225.957C1268.18 230.678 1269.6 234.927 1269.91 238.704C1270.54 242.166 1270.86 247.516 1270.86 254.755V419.984C1270.86 427.223 1270.54 432.731 1269.91 436.507C1269.6 439.969 1268.34 444.061 1266.14 448.782C1261.73 456.964 1250.87 461.056 1233.56 461.056C1216.57 461.056 1205.08 459.01 1199.1 454.919C1193.44 450.513 1190.13 444.218 1189.19 436.035C1177.54 452.716 1158.03 461.056 1130.65 461.056C1103.58 461.056 1078.4 448.624 1055.11 423.761C1031.83 398.898 1020.18 370.101 1020.18 337.37C1020.18 304.324 1031.83 275.526 1055.11 250.978C1078.72 226.115 1104.53 213.683 1132.54 213.683C1143.24 213.683 1152.99 215.572 1161.81 219.348C1170.62 223.125 1176.76 226.744 1180.22 230.206C1183.68 233.353 1186.51 236.501 1188.71 239.648ZM1102.8 337.842C1102.8 348.227 1106.89 357.669 1115.07 366.167C1123.25 374.35 1133.17 378.441 1144.81 378.441C1156.46 378.441 1166.05 374.192 1173.61 365.695C1181.48 357.197 1185.41 347.913 1185.41 337.842C1185.41 327.456 1181.63 317.857 1174.08 309.044C1166.84 300.232 1156.93 295.826 1144.34 295.826C1132.06 295.826 1121.99 300.232 1114.13 309.044C1106.57 317.857 1102.8 327.456 1102.8 337.842ZM1444.92 213.683C1472.93 213.683 1498.58 226.115 1521.87 250.978C1545.47 275.841 1557.27 304.796 1557.27 337.842C1557.27 370.573 1545.63 399.37 1522.34 424.233C1499.05 448.782 1474.03 461.056 1447.28 461.056C1420.53 461.056 1401.49 453.502 1390.16 438.396C1387.64 453.817 1374.1 461.528 1349.56 461.528C1329.73 461.528 1317.61 457.279 1313.21 448.782C1311 444.061 1309.59 439.969 1308.96 436.507C1308.64 432.731 1308.48 427.223 1308.48 419.984V138.15C1308.48 130.911 1308.64 125.561 1308.96 122.099C1309.59 118.322 1311 114.231 1313.21 109.825C1317.61 101.327 1329.89 97.0782 1350.03 97.0782C1369.86 97.0782 1381.82 101.327 1385.91 109.825C1388.42 114.545 1389.84 118.794 1390.16 122.571C1390.78 126.033 1391.1 131.383 1391.1 138.622V236.815C1403.69 221.394 1421.63 213.683 1444.92 213.683ZM1403.37 366.167C1411.24 374.664 1421 378.913 1432.64 378.913C1444.29 378.913 1454.2 374.664 1462.38 366.167C1470.57 357.669 1474.66 348.227 1474.66 337.842C1474.66 327.456 1470.88 318.014 1463.33 309.517C1455.78 300.704 1445.7 296.298 1433.11 296.298C1420.53 296.298 1410.45 300.704 1402.9 309.517C1395.66 318.329 1392.04 327.928 1392.04 338.314C1392.04 348.385 1395.82 357.669 1403.37 366.167ZM1819.18 216.044C1837.75 224.226 1847.04 234.14 1847.04 245.785C1847.04 251.45 1845.78 256.8 1843.26 261.836C1840.74 266.871 1839.48 269.547 1839.48 269.861L1715.8 546.503C1713.28 552.483 1711.08 557.046 1709.19 560.194C1707.62 563.341 1704.94 566.331 1701.16 569.163C1697.39 571.996 1692.67 573.412 1687 573.412C1681.34 573.412 1673 571.052 1661.98 566.331C1643.41 558.148 1634.13 548.392 1634.13 537.062C1634.13 529.508 1649.23 493.472 1679.45 428.954L1585.5 270.806C1579.21 260.42 1576.06 252.709 1576.06 247.673C1576.06 237.602 1584.56 227.531 1601.55 217.46C1612.25 211.165 1620.59 208.018 1626.57 208.018C1632.55 208.018 1637.43 209.277 1641.21 211.795C1644.99 214.313 1647.66 216.988 1649.23 219.82C1651.12 222.338 1659.78 236.973 1675.2 263.724C1690.93 290.161 1705.88 314.867 1720.05 337.842C1721.62 332.806 1730.12 313.451 1745.54 279.775C1760.96 245.785 1769.14 227.688 1770.09 225.485C1771.35 223.282 1773.23 220.607 1775.75 217.46C1779.84 212.11 1785.51 209.434 1792.75 209.434C1800.3 209.434 1809.11 211.638 1819.18 216.044ZM1872.77 137.678C1872.77 130.439 1872.93 125.089 1873.25 121.627C1873.88 117.85 1875.29 113.601 1877.49 108.88C1881.9 100.383 1894.17 96.134 1914.32 96.134C1933.52 96.134 1945.47 100.383 1950.2 108.88C1952.71 113.601 1954.13 117.85 1954.44 121.627C1955.07 125.403 1955.39 130.911 1955.39 138.15V356.725C1955.39 368.055 1956.33 375.294 1958.22 378.441C1960.11 381.273 1964.2 382.69 1970.5 382.69C1977.1 382.69 1981.51 383.004 1983.71 383.634C1985.92 383.949 1988.59 385.207 1991.74 387.411C1998.03 391.502 2001.18 402.675 2001.18 420.929C2001.18 440.756 1998.03 452.873 1991.74 457.279C1983.56 462.944 1964.04 463.888 1933.2 460.112C1908.97 456.964 1893.23 448.939 1885.99 436.035C1877.18 420.614 1872.77 396.065 1872.77 362.39V137.678ZM2020.13 337.842C2020.13 300.075 2033.35 268.917 2059.79 244.369C2086.23 219.82 2116.44 207.546 2150.43 207.546C2184.42 207.546 2214.48 219.82 2240.6 244.369C2266.72 268.602 2279.78 299.603 2279.78 337.37C2279.78 363.492 2273.01 386.781 2259.48 407.238C2245.95 427.38 2229.43 442.33 2209.91 452.086C2190.71 461.528 2170.73 466.249 2149.96 466.249C2129.19 466.249 2109.04 461.213 2089.53 451.142C2070.02 440.756 2053.49 425.649 2039.96 405.822C2026.74 385.68 2020.13 363.019 2020.13 337.842ZM2118.8 371.832C2128.87 379.385 2139.1 383.162 2149.49 383.162C2159.87 383.162 2170.26 379.228 2180.64 371.36C2191.03 363.492 2196.22 351.847 2196.22 336.425C2196.22 321.004 2191.34 309.517 2181.59 301.963C2171.83 294.41 2161.29 290.633 2149.96 290.633C2138.63 290.633 2128.08 294.567 2118.33 302.435C2108.57 310.303 2103.69 321.948 2103.69 337.37C2103.69 352.476 2108.73 363.964 2118.8 371.832ZM2448.6 213.211C2480.08 213.211 2506.2 225.328 2526.97 249.562C2548.06 273.481 2558.6 302.75 2558.6 337.37V420.457C2558.6 427.695 2558.28 433.203 2557.65 436.979C2557.34 440.441 2556.08 444.375 2553.88 448.782C2549.47 457.279 2537.2 461.528 2517.06 461.528C2494.71 461.528 2481.81 455.706 2478.34 444.061C2476.46 438.71 2475.51 430.685 2475.51 419.984V336.897C2475.51 323.994 2471.74 313.923 2464.18 306.684C2456.94 299.445 2447.03 295.826 2434.44 295.826C2422.17 295.826 2412.1 299.603 2404.23 307.156C2396.67 314.709 2392.9 324.623 2392.9 336.897V420.457C2392.9 427.695 2392.58 433.203 2391.95 436.979C2391.64 440.441 2390.22 444.375 2387.7 448.782C2383.61 457.279 2371.5 461.528 2351.35 461.528C2331.53 461.528 2319.41 457.279 2315 448.782C2312.8 444.061 2311.38 439.969 2310.75 436.507C2310.44 432.731 2310.28 427.223 2310.28 419.984V252.866C2310.28 245.942 2310.44 240.749 2310.75 237.287C2311.38 233.511 2312.96 229.419 2315.48 225.013C2319.88 217.145 2332 213.211 2351.83 213.211C2371.02 213.211 2382.83 216.83 2387.23 224.069C2390.38 229.419 2391.95 235.871 2391.95 243.425C2393.21 241.222 2396.04 238.074 2400.45 233.983C2404.86 229.891 2409.11 226.587 2413.2 224.069C2423.9 216.83 2435.7 213.211 2448.6 213.211Z" fill="white"/>
          </svg>
        </div>
      </header>

      <main style={{ zIndex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', textAlign: 'center' }}>
        <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '8px' }}>
          <span style={{ fontSize: 40 }}>{config.emoji}</span>
          <p
            style={{
              fontSize: 20,
              textTransform: 'uppercase',
              letterSpacing: '0.25em',
              color: 'rgba(226, 232, 255, 0.65)',
              fontWeight: 500,
            }}
          >
            {config.title}
          </p>
        </div>
        <p
          style={{
            marginTop: 12,
            fontSize: 120,
            fontWeight: 700,
            lineHeight: 1,
            color: data.unrealizedPnL >= 0 ? '#34D399' : '#F87171',
          }}
        >
          {data.unrealizedPnL >= 0 ? '+' : ''}
          {formatCurrency(data.unrealizedPnL)}
        </p>

        <div
          style={{
            marginTop: 32,
            display: 'flex',
            gap: 48,
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <MiniStat title="Open Positions" value={data.positionCount.toString()} />
          {data.totalValue !== undefined && (
            <MiniStat title="Total Value" value={formatCurrency(data.totalValue)} />
          )}
        </div>
      </main>

      <footer
        style={{
          display: 'flex',
          justifyContent: 'center',
          alignItems: 'center',
          zIndex: 1,
        }}
      >
        <p
          style={{
            fontSize: 18,
            color: 'rgba(226, 232, 255, 0.6)',
            letterSpacing: '0.08em',
            textTransform: 'uppercase',
          }}
        >
          Trade the narrative. Share the upside.
        </p>
      </footer>
    </div>
  )
}

interface MiniStatProps {
  title: string
  value: string
}

function MiniStat({ title, value }: MiniStatProps) {
  return (
    <div
      style={{
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        gap: 8,
      }}
    >
      <p
        style={{
          fontSize: 16,
          fontWeight: 500,
          color: 'rgba(226, 232, 255, 0.6)',
          textTransform: 'uppercase',
          letterSpacing: '0.1em',
        }}
      >
        {title}
      </p>
      <p
        style={{
          fontSize: 28,
          fontWeight: 700,
          color: '#F8FAFC',
        }}
      >
        {value}
      </p>
    </div>
  )
}

